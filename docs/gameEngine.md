# Игровой движок

- [Базовые классы](#базовые-классы)
    - [Game](#game)
    - [GameInputHandler](#gameinputhandler)
    - [Timer](#timer)
    - [SpriteImage](#spriteimage)
    - [SpriteAnimation](#spriteanimation)
- [Классы игровых объектов](#классы-игровых-объектов)
    - [Player](#player)
    - [Road](#road)
    - [Vehicle](#vehicle)
- [Вспомогательные классы](#вспомогательные-классы)
    - [Load](#load)

---

## Базовые классы

### Game

Основной класс, здесь запускается игровой цикл, здесь запускается инициализация всех игровых объектов. А также
содержатся вспомогательные методы по работе с различной логикой игры.

| Свойство      | Описание                      |
|:--------------|:------------------------------|
| **maxSpeed**  | задает максимальную скорость  |
| **RUNNING**   | состояние игрока "движется"   |
| **EXPLODING** | состояние игрока "взрывается" |

| Метод                    | Описание               |
|:-------------------------|:-----------------------|
| **start(canvasElement)** | запуск игрового движка |

Пример инициализации и запуска игрового движка:

```typescript
const game: Game = new Game();
game.start(document.querySelector('canvas'));
```

---

### GameInputHandler

Базовый класс отвечающий за управление входными состояниями для игры. Он отслеживает события клавиатуры для
обновления `inputStates` объекта, который затем можно использовать для определения текущего состояния ввода
пользователя:

| Свойство        | Описание                                                                   |
|:----------------|:---------------------------------------------------------------------------|
| **inputStates** | объект для хранения текущих состояний различных входов (клавиатуры и мыши) |

| Метод                    | Описание                                                                                                                                           |
|:-------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------|
| **addWindowListeners()** | добавляет в окно слушатели событий для отслеживания событий клавиатуры ( `keydown` и `keyup`) и соответствующим образом обновляет их `inputStates` |
| **getInputStates()**     | возвращает текущее состояние входных данных                                                                                                        |

---

### Timer

Базовый класс-таймер для отсчитывания времени продолжительности движения:

| Свойство    | Описание               |
|:------------|:-----------------------|
| **oldTime** | время последнего кадра |

| Метод                            | Описание                                                                                                                          |
|:---------------------------------|:----------------------------------------------------------------------------------------------------------------------------------|
| **getDelta(currentTime)**        | вычисляет разницу во времени между текущим временем и последним записанным временем, обновляя его `oldTime` для следующего вызова |
| **distanceToMove(delta, speed)** | вычисляет расстояние перемещения на основе разницы во времени `delta` и скорости объекта                                          |

--- 

### SpriteImage

Базовый класс представляет отдельный спрайт (изображение) для отрисовки на холсте. Он содержит данные об изображении,
его координатах на спрайт-листе и его размерах:

| Свойство   | Описание                                  |
|:-----------|:------------------------------------------|
| **image**  | изображение, которое будет отрисовываться |
| **x**      | координата x на спрайт-листе              |
| **y**      | координата y на спрайт-листе              |
| **width**  | ширина спрайта                            |
| **height** | высота спрайта                            |

| Метод                                      | Описание                                                                                                            |
|:-------------------------------------------|:--------------------------------------------------------------------------------------------------------------------|
| **draw(ctx, xPosition, yPosition, scale)** | отвечает за отрисовку спрайта на указанных координатах с возможностью масштабирования(по-умолчанию масштаб равен 1) |

---

### SpriteAnimation

Базовый класс для отрисовки анимации, состоящей из нескольких спрайтов:

| Свойство                     | Описание                                                               |
|:-----------------------------|:-----------------------------------------------------------------------|
| **spriteArray**              | массив объектов SpriteImage, представляющих отдельные спрайты анимации |
| **currentFrame**             | индекс текущего спрайта в массиве `spriteArray`                        |
| **delayBetweenFrames**       | задержка между кадрами анимации в миллисекундах                        |
| **totalTimeSinceLastRedraw** | общее время, прошедшее с отрисовки последнего кадра анимации           |

| Метод                               | Описание                                                                                                                              |
|:------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------|
| **draw(ctx, xPosition, yPosition)** | отвечает за отрисовку спрайта на указанных координатах                                                                                |
| **extractSprites()**                | извлекает спрайты из переданного спрайт-листа и создает для каждого спрайта объект `SpriteImage`, добавляя его в массив `spriteArray` |
| **setNbImagesPerSecond(fps)**       | устанавливает задержку между кадрами анимации на основе переданного количества кадров в секунду                                       |

## Классы игровых объектов

### Player

Описывает логику работы с объектом автомобиля игрока, применяя следующие свойства и методы:

| Свойство      | Описание                      |
|:--------------|:------------------------------|
| **ctx**       | контекст рисования            |
| **maxSpeed**  | задает максимальную скорость  |
| **RUNNING**   | состояние игрока "движется"   |
| **EXPLODING** | состояние игрока "взрывается" |

| Метод                        | Описание                                                                        |
|:-----------------------------|:--------------------------------------------------------------------------------|
| **setState(state)**          | устанавливает новое состояние автомобиля игрока и сбрасывает анимацию взрыва    |
| **setImage(image, ...args)** | задает спрайт игрока                                                            |
| **setExplosion(image)**      | задает анимацию взрыва                                                          |
| **moveToStartPosition()**    | устанавливает начальную позицию игрока                                          |
| **setPosition(x, y)**        | задает текущую позицию игрока                                                   |
| **update(deltaTime)**        | обновляет состояние игрока в зависимости от текущего состояния и входных данных |

Пример инициализации, установки стартовой позиции и состояния движения автомобиля игрока:

```typescript
const player: Index = new Index(this.ctx, this.inputStates);
player.setImage(images[audi], 78, 24, 96, 216);
player.setExplosion(images[explosion]);
player.moveToStartPosition();
player.setState(Index.RUNNING);
```

---

### Road

Описывает логику движения дороги относительно игрока, применяя следующие свойства и методы:

| Свойство         | Описание                                     |
|:-----------------|:---------------------------------------------|
| **ctx**          | контекст рисования                           |
| **LANE_CENTER**  | задает центральные положения полос на дороге |
| **inputStates**  | состояния ввода нажатия клавиш               |
| **speed**        | скорость движения дороги                     |
| **accel**        | ускорение движения дороги                    |
| **totalSeconds** | общее время с начала игры                    |
| **sprite**       | спрайт изображения дороги                    |

| Метод                        | Описание                                                                        |
|:-----------------------------|:--------------------------------------------------------------------------------|
| **setImage(image, ...args)** | задает спрайт дороги                                                            |
| **update(deltaTime)**        | обновляет состояние дороги в зависимости от текущего состояния и входных данных |

Пример инициализации дороги:

```typescript
const road: Road = new Road(this.ctx, this.inputStates);
road.setImage(images[road], 0, 0, 840, 650);
```

---

### Vehicle

Описывает логику работы движения и появления на дороге транспортных средств, применяя следующие свойства и методы:

| Свойство        | Описание                                      |
|:----------------|:----------------------------------------------|
| **ctx**         | контекст рисования                            |
| **scale**       | масштаб изображения транспортного средства    |
| **speed**       | скорость движения транспортного средства      |
| **sprite**      | спрайт транспортного средства                 |
| **position**    | позиция транспортного средства                |
| **lane**        | номер полосы генерации транспортного средства |
| **startOffset** | начальное смещение                            |

| Метод                        | Описание                                                                                        |
|:-----------------------------|:------------------------------------------------------------------------------------------------|
| **setImage(image, ...args)** | задает спрайт транспортного средства                                                            |
| **moveToStartPosition()**    | устанавливает начальную позицию транспортного средства на случайно выбранную полосу             |
| **update(deltaTime)**        | обновляет состояние транспортного средства в зависимости от текущего состояния и входных данных |

Пример инициализации и установки стартовой позиции транспортного средства:

```typescript
const truck: Vehicle = new Vehicle(this.ctx);
truck.setImage(images[truck], 78, 24, 96, 216);
truck.moveToStartPosition(450);
```

## Вспомогательные классы

### Load

Вспомогательный класс для загрузки файлов изображений:

| Метод                | Описание                                                               |
|:---------------------|:-----------------------------------------------------------------------|
| **images(...files)** | загружает файлы и сохраняет в виде объектов с типом `HTMLImageElement` |
